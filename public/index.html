<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="msapplication-tap-highlight" content="no" />

    <title>Clong</title>

    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <div id="clong-main"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <script>
    var wsProtocol = 'ws';
    if (window.location.protocol === "https:") {
        wsProtocol = 'wss';
    }
    var ws = new WebSocket(wsProtocol + '://' + window.location.host + '/ws/client');
    var clong = document.getElementById('clong-main');
    var mc = new Hammer(clong);
    var myColor = '#fff';
    var w = 0;
    var h = 0;

    function calcScreenSize() {
        w = Math.max(document.documentElement.clientWidth, window.innerWidth || 0);
        h = Math.max(document.documentElement.clientHeight, window.innerHeight || 0);
    }

    function relW(val) {
        return (val / w) * 100;
    }
    function relH(val) {
        return (val / h) * -100;
    }
    function rel(val) {
        return (val / Math.max(w,h)) * 100;
    }

    function randomColor() {
        var letters = '0123456789ABCDEF';
        var color = '#';

        for (var i = 0; i < 6; i++ ) {
            color += letters[Math.floor(Math.random() * 16)];
        }

        return color;
    }

    function init() {
        calcScreenSize();
        window.addEventListener('resize', (e) => {
            calcScreenSize();
        });

        myColor = randomColor();
        clong.style.backgroundColor = myColor;

        mc.get('swipe').set({ direction: Hammer.DIRECTION_ALL });
        mc.on('swipe', function(e) {
            var msg = {
                color: myColor,
                posX: relW(e.center.x),
                velocityX: rel(e.deltaX) * 0.01,
                velocityY: relH(e.deltaY) * 0.02,
            };
            console.log(msg);

            ws.send(JSON.stringify(msg));
        });
    }

    init();
    </script>
</body>
